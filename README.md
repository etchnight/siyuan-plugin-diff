# 比较与合并文档

[English](./README_en_US.md)

思源笔记插件，比较文档差异和合并文档。

该插件的初衷是为了解决外部导入的内容（如网页剪藏等）有更新，但在思源笔记内的相应笔记已进行了链接、样式修改等操作，需要将新导入的文档合并到原文档的情况。故目前合并建议为修改原文档，而不考虑新导入文档的更新问题。


<div class="markdown-alert markdown-alert-warning" dir="auto" style="padding: 0.5rem 1rem; margin-bottom: 16px; color: inherit; border-left: 0.25em solid; border-left-color: #9e6a03;">
      <p class="markdown-alert-title" dir="auto" style="margin-top: 0; display: flex; font-weight: 500; align-items: center; line-height: 1; color: #d29922;">
        <svg class="octicon octicon-alert mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true" style="display: inline-block; vertical-align: text-bottom; fill: currentColor; overflow: visible; margin-right: 0.5rem;">
          <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" class=""/></svg>Warning
      </p>

   <p dir="auto" class style="margin-bottom: 0;">
        该项目还处在早期阶段，存在不稳定性，请谨慎使用。请特别注意目前问题部分。
   </p>
      <p dir="auto" class>
   生成的比较视图中，每个超级块最左侧块，对其的修改将同步到原文档对应块，请特别注意。
   </p>
</div>

## 使用方法

1. 点击右上图标按钮(文档差异比较与合并)
2. 搜索选定原文档（文档 1）和想要与之比较的文档（文档 2），点击开始比较
3. 将生成原文档的副本，并在该副本中逐块显示差异
   - 超级块最左侧块为文档 1 中的块
   - 超级块中间块为差异展示，其中块形式、样式全部同文档 2，文字绿色表示添加，红色表示删除
   - 超级块中右侧块为合并建议，其中块形式、样式全部同文档 1，文字同文档 2
4. 确认对比情况
   - **每个超级块最左侧块会自动绑定文档 1 中的块，对其进行修改会同步修改文档 1 内容**
   - 对于新增的块，点击其所在超级块块标，可使用`将新增内容添加到原文档`功能将其添加到原文档中
   - 可通过右上角上下按钮移动到下一处更改的块

## 比较方式

目前比较采用的方法较为低效，对每个块均要经过 3 次比较：

1. 块级更改：增加、删除、内部更改，这一步是为了将新块与原块进行一一对应，当其内部文字内容字符差异低于 50% 时，视为对应的块。
2. 行级更改：增加、删除、容器块更改、内部更改，这一步是为了将容器块（引用、列表等）内部的块进行一一对应，其中容器块更改表示如列表变为引用等。
3. 字符级更改：增加、删除，**样式更改不会被检测**，会保留原文档的行内样式。

## 目前问题

- 没有使用动态加载，比较超大文档可能会卡顿
- 比较视图使用的是 Protyle（思源文档编辑器界面），但是里面的块均是虚拟的，即本地文件和数据库中不存在真实的比较文档，在其中进行编辑可能存在风险，虽然目前尚未发现较为严重的问题
